<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fluffy Robot Dashboard</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
	<script src="https://go-echarts.github.io/go-echarts-assets/assets/echarts.min.js"></script>
    <link rel="stylesheet" href="static/style.css">
</head>
<body>

    <!-- Hidden container that mirrors current URL query params needed for htmx requests -->
    <form id="query-state" style="display:none;">
        <input type="hidden" name="agents" id="qs-agents" value="">
    </form>

    <script>
      // Mirror URL query params needed by htmx and optionally auto-load a chart when a period is present. 
      document.addEventListener('DOMContentLoaded', function () {
        try {
          var usp = new URLSearchParams(window.location.search || "");

          // Mirror agents from URL into hidden field
          // Server side parser supports repeated keys (?agents=A&agents=B) and CSV (?agents=A,B).
          var vals = usp.getAll('agents');
          var field = document.getElementById('qs-agents');
          if (field) {
            // Preserve order and duplicates; server will normalize.
            field.value = vals.join(',');
          }

          // Auto-load chart if period is present
          var period = usp.get('period');
          if (period && period.trim() !== '') {
            var values = { period: period };
            if (field && field.value) values.agents = field.value; // comma-separated OK
            htmx.ajax('GET', '/chart', {
              target: '#chart-content', swap: 'innerHTML', values: values
            });
          }
        } catch (_) { /* no-op */ }
      });
    </script>

    <header id="header-status">
	<!--
        <div hx-get="/status"  hx-swap="outerHTML"> 
        </div>
		-->
        <div class="button-group">
		Time range: 
            <button class="time-button" hx-get="/chart" hx-vals='{"period":"1h"}' hx-include="#query-state" hx-target="#chart-content">Last 1h</button>
            <button class="time-button" hx-get="/chart" hx-vals='{"period":"4h"}' hx-include="#query-state" hx-target="#chart-content">Last 4h</button>
            <button class="time-button" hx-get="/chart" hx-vals='{"period":"24h"}' hx-include="#query-state" hx-target="#chart-content">Last 24h</button>
            <button class="time-button" hx-get="/chart" hx-vals='{"period":"7d"}' hx-include="#query-state" hx-target="#chart-content">Last 7d</button>
		</div>
    </header>

    <div class="main-container">
        
	<!--
        <div id="sidebar">
            <h3>Time Filters</h3>
            <button class="time-button" hx-get="/chart" hx-vals='{"period": "1h"}' hx-target="#chart-content">Load Last Hour</button>
            <button class="time-button" hx-get="/chart" hx-vals='{"period": "4h"}' hx-target="#chart-content">Load Last 4 Hours</button>
            <button class="time-button" hx-get="/chart" hx-vals='{"period": "24h"}' hx-target="#chart-content">Load Last 24 Hours</button>
            
            <div class="agent-list" id="agent-list-container">
                <h3>Agents</h3>
                <div hx-get="/agents" hx-trigger="load" hx-target="this" hx-swap="innerHTML">
                    Loading agents...
                </div>
            </div>
        </div>
	-->
        <div id="content">
            <h2>Chart Visualization</h2>
            <div id="chart-content">
                Click a filter button to load a chart.
            </div>
        </div>

    </div>

</body>
</html>
`

